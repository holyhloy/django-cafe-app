{% extends 'base.html' %}

{% block content %}
<h1>Создание заказа</h1>
<form id="form-container" method="post">
    {% csrf_token %}
    {{ order_form.as_p }}

    <div id="item-forms">
        {{ item_formset.management_form }}
        {% for form in item_formset %}
            <div class="item-form">
                {{ form.as_p }}
            </div>
        {% endfor %}
    </div>

    <button type="button" id="add-form">Добавить блюдо</button>
    <button type="submit">Создать заказ</button>
    <button type="button" onclick="location.href='{% url "index" %}'">Отмена</button>
</form>

<script>
let itemForm = document.querySelectorAll(".item-form")
let container = document.querySelector("#form-container")
let addButton = document.querySelector("#add-form")
let totalForms = document.querySelector("#id_form-TOTAL_FORMS")

let formNum = itemForm.length-1
addButton.addEventListener('click', addForm)

function addForm(e){
    e.preventDefault()

    let newForm = itemForm[0].cloneNode(true)
    let formRegex = RegExp(`form-(\\d){1}-`,'g')

    formNum++
    newForm.innerHTML = newForm.innerHTML.replace(formRegex, `form-${formNum}-`)
    container.insertBefore(newForm, addButton)

    totalForms.setAttribute('value', `${formNum+1}`)
}
</script>

{% endblock %}